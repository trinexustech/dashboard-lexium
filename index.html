<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lexium AI | Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* --- NEW: Styles for the Generation Wizard --- */
        .wizard-overlay {
            transition: opacity 0.3s ease-in-out;
        }
        .wizard-container {
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }
        @keyframes pulse-bg {
            0%, 100% { background-color: rgba(37, 99, 235, 0.1); }
            50% { background-color: rgba(37, 99, 235, 0.2); }
        }
        .generating-animation {
            animation: pulse-bg 2s infinite;
        }
    </style>
</head>
<body class="bg-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // --- HELPER COMPONENTS (ICONS) ---
        const DashboardIcon = () => (
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>
        );
        const DocumentIcon = () => (
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>
        );
        const AuditIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/><path d="m6 19-2 2 4-4 2 2-4 4"/></svg>
        );
        const SettingsIcon = () => (
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l-.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
        );
        const LogoutIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
        );
        const BackIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>;
        const CheckIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>;


        // --- MOCK DATA ---
        const initialDocumentsData = [
            { id: 1, name: 'Privacy Policy', status: 'Active', score: 98, lastAudit: 'Sep 15, 2025', owner: 'You', createdAt: 'Aug 01, 2025', version: '2.1', auditHistory: [ {date: 'Sep 15, 2025', event: 'Weekly AI Audit', result: 'Pass'}, {date: 'Sep 1, 2025', event: 'Manual Review', result: 'Approved by legal'}, {date: 'Aug 1, 2025', event: 'Document Generated', result: 'Version 1.0'} ]},
            { id: 2, name: 'AI Usage Policy', status: 'Needs Review', score: 85, lastAudit: 'Sep 15, 2025', owner: 'You', createdAt: 'Aug 10, 2025', version: '1.2', auditHistory: [ {date: 'Sep 15, 2025', event: 'Weekly AI Audit', result: 'Warning: New AI model usage not covered.'}, {date: 'Aug 10, 2025', event: 'Document Generated', result: 'Version 1.0'} ] },
            { id: 3, name: 'Record of Processing Activities (ROPA)', status: 'Draft', score: null, lastAudit: 'N/A', owner: 'You', createdAt: 'Sep 05, 2025', version: '0.5', auditHistory: [ {date: 'Sep 05, 2025', event: 'Document Generated', result: 'Initial draft'} ] },
            { id: 4, name: 'Data Processing Agreement - Standard', status: 'Active', score: 100, lastAudit: 'Sep 12, 2025', owner: 'You', createdAt: 'Jul 20, 2025', version: '3.0', auditHistory: [ {date: 'Sep 12, 2025', event: 'Human Review', result: 'Approved'}, {date: 'Jul 20, 2025', event: 'Document Generated', result: 'Version 1.0'} ] },
        ];
        
        // --- NEW: Mock Data for Audit Reports ---
        const auditReportsData = [
            { id: 101, date: 'Sep 15, 2025', status: 'Warning Detected', summary: '1 high-priority warning found in AI Usage Policy.', findings: [ {id: 'f1', severity: 'High', document: 'AI Usage Policy', description: 'Policy does not include recently integrated third-party AI analytics service (Vendor X).', recommendation: 'Update the policy to include Vendor X, detail the data being processed, and specify the legal basis for processing.'}, {id: 'f2', severity: 'Low', document: 'Privacy Policy', description: 'Minor typo found in the data retention section.', recommendation: 'Correct the typographical error in section 7.2.'} ] },
            { id: 102, date: 'Sep 08, 2025', status: 'No Issues Found', summary: 'All documents are compliant with current regulations.', findings: [] },
            { id: 103, date: 'Sep 01, 2025', status: 'No Issues Found', summary: 'All documents are compliant with current regulations.', findings: [] }
        ];

        // --- HELPER FUNCTIONS ---
        const getStatusChip = (status) => {
            switch (status) {
                case 'Active': return <span className="bg-green-500/10 text-green-400 text-xs font-medium px-2.5 py-1 rounded-full">‚úÖ Active</span>;
                case 'Needs Review': return <span className="bg-yellow-500/10 text-yellow-400 text-xs font-medium px-2.5 py-1 rounded-full">‚ö†Ô∏è Needs Review</span>;
                case 'Draft': return <span className="bg-slate-500/10 text-slate-400 text-xs font-medium px-2.5 py-1 rounded-full">üìù Draft</span>;
                default: return null;
            }
        };
        const getAuditStatusChip = (status) => {
             switch (status) {
                case 'No Issues Found': return <span className="bg-green-500/10 text-green-400 text-xs font-medium px-2.5 py-1 rounded-full">‚úÖ No Issues Found</span>;
                case 'Warning Detected': return <span className="bg-yellow-500/10 text-yellow-400 text-xs font-medium px-2.5 py-1 rounded-full">‚ö†Ô∏è Warning Detected</span>;
                default: return <span className="bg-slate-500/10 text-slate-400 text-xs font-medium px-2.5 py-1 rounded-full">{status}</span>;
            }
        };
        const getComplianceBar = (score) => {
            if (score === null) return <span className="text-slate-500">-</span>;
            const width = `${score}%`;
            let colorClass = score < 90 ? 'bg-yellow-500' : (score >= 98 ? 'bg-green-500' : 'bg-blue-500');
            return (
              <div className="flex items-center gap-2">
                <div className="w-24 bg-slate-700 rounded-full h-2"><div className={`${colorClass} h-2 rounded-full`} style={{ width }}></div></div>
                <span className="text-sm text-white font-medium">{score}%</span>
              </div>
            );
        };

        // --- CHART COMPONENTS ---
        const ComplianceDonutChart = () => {
            const chartRef = useRef(null);
            useEffect(() => {
                const chartInstance = new Chart(chartRef.current, {
                    type: 'doughnut',
                    data: {
                        labels: ['Compliant', 'Needs Review'],
                        datasets: [{ data: [96, 4], backgroundColor: ['#2563EB', '#374151'], borderColor: '#111827', borderWidth: 4, hoverOffset: 4 }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, cutout: '80%', plugins: { legend: { display: false }, tooltip: { enabled: false } } }
                });
                return () => chartInstance.destroy();
            }, []);
            return (
                <div className="relative w-40 h-40">
                    <canvas ref={chartRef}></canvas>
                    <div className="absolute inset-0 flex items-center justify-center">
                        <div className="text-center">
                            <span className="text-4xl font-bold text-white">96%</span>
                            <span className="block text-xs text-slate-400 -mt-1">Compliance</span>
                        </div>
                    </div>
                </div>
            );
        };

        const ComplianceTrendChart = () => {
            const chartRef = useRef(null);
            useEffect(() => {
                const ctx = chartRef.current.getContext('2d');
                const gradient = ctx.createLinearGradient(0, 0, 0, 80);
                gradient.addColorStop(0, 'rgba(37, 99, 235, 0.5)');
                gradient.addColorStop(1, 'rgba(37, 99, 235, 0)');
                const chartInstance = new Chart(chartRef.current, {
                    type: 'line',
                    data: {
                        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                        datasets: [{ data: [92, 94, 93, 96], borderColor: '#2563EB', borderWidth: 2, pointRadius: 0, tension: 0.4, fill: true, backgroundColor: gradient }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false, min: 90, max: 100 } } }
                });
                return () => chartInstance.destroy();
            }, []);
            return (<div className="w-48 h-20"><canvas ref={chartRef}></canvas></div>);
        };
        
        // --- AUTH & VIEW COMPONENTS ---
        const LoginPrompt = ({ onLogin }) => (
            <div className="flex flex-col items-center justify-center min-h-screen text-center text-white p-4">
                <h1 className="text-4xl font-bold">Access Denied</h1>
                <p className="text-slate-400 mt-2">Please log in via our main website to access your dashboard.</p>
                <a href="https://trinexustech.github.io/lexium" className="mt-6 bg-blue-600 text-white px-6 py-3 rounded-md font-semibold hover:bg-blue-500 transition-colors">Return to Homepage</a>
                <div className="mt-8 border-t border-slate-700 pt-6 text-sm text-slate-500">
                    <p>For MVP demonstration purposes only:</p>
                    <button onClick={onLogin} className="mt-2 text-blue-400 underline hover:text-blue-300">Simulate Login</button>
                </div>
            </div>
        );

        const PlaceholderView = ({ title, message }) => (
            <div>
                 <header className="mb-8">
                    <h1 className="text-3xl font-bold text-white">{title}</h1>
                    <p className="text-slate-400 mt-1">{message}</p>
                </header>
                <div className="bg-[#0D1117] border border-slate-800 rounded-xl p-16 text-center">
                    <h2 className="text-xl font-semibold text-white">Feature Coming Soon</h2>
                    <p className="text-slate-400 mt-2">This area is currently under development. Check back later for updates!</p>
                </div>
            </div>
        );

        const MainDashboardView = ({userEmail, onStartGeneration, documents, onNavigateToAudits}) => {
            const latestAudit = auditReportsData[0];
            return (
            <div>
                <header className="flex justify-between items-start mb-8">
                    <div>
                        <h1 className="text-3xl font-bold text-white">Dashboard</h1>
                        <p className="text-slate-400 mt-1">Welcome back, {userEmail || "user"}! Here's your compliance overview.</p>
                    </div>
                    <div className="flex items-center gap-6 bg-[#0D1117] border border-slate-800 p-4 rounded-xl">
                       <ComplianceDonutChart />
                       <div className="border-l border-slate-700 h-24"></div>
                       <div>
                           <h3 className="text-sm font-semibold text-white mb-1">Compliance Trend</h3>
                           <p className="text-xs text-slate-400 mb-2">Last 4 Weeks</p>
                           <ComplianceTrendChart/>
                       </div>
                    </div>
                </header>
                
                <div className="grid grid-cols-3 gap-8">
                    <div className="col-span-2 bg-[#0D1117] border border-slate-800 rounded-xl">
                        <div className="p-6 flex justify-between items-center border-b border-slate-800">
                          <h2 className="text-lg font-semibold text-white">Your Compliance Documents</h2>
                          <button onClick={onStartGeneration} className="bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-blue-500 transition-colors">Generate New Document</button>
                        </div>
                        <table className="w-full text-left">
                            <thead className="border-b border-slate-800"><tr className="text-xs text-slate-400 uppercase"><th className="p-4 font-semibold">Document Name</th><th className="p-4 font-semibold">Status</th><th className="p-4 font-semibold">Score</th><th className="p-4 font-semibold">Actions</th></tr></thead>
                            <tbody>
                                {documents.slice(0, 4).map(doc => (
                                    <tr key={doc.id} className="border-b border-slate-800 last:border-b-0 hover:bg-slate-800/20">
                                        <td className="p-4 text-sm font-medium text-white">{doc.name}</td>
                                        <td className="p-4">{getStatusChip(doc.status)}</td>
                                        <td className="p-4">{getComplianceBar(doc.score)}</td>
                                        <td className="p-4"><button className="text-xs text-blue-400 hover:text-blue-300 font-semibold">{doc.status === 'Needs Review' ? 'Review' : 'Audit Now'}</button></td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                    {/* --- NEW: Latest Audit Summary Card --- */}
                    <div className="col-span-1 bg-[#0D1117] border border-slate-800 rounded-xl p-6 flex flex-col">
                        <h2 className="text-lg font-semibold text-white mb-4">Latest Weekly Audit</h2>
                        <p className="text-sm text-slate-400 mb-1">{latestAudit.date}</p>
                        {getAuditStatusChip(latestAudit.status)}
                        <p className="text-sm text-slate-300 mt-4 flex-grow">{latestAudit.summary}</p>
                        <button onClick={onNavigateToAudits} className="mt-4 w-full bg-slate-700 text-white p-2.5 rounded-md font-semibold hover:bg-slate-600 transition-colors text-sm">View Full Report</button>
                    </div>
                </div>
            </div>
            );
        };

        const DocumentsListView = ({ documents, onSelectDocument, onStartGeneration }) => (
            <div>
                 <header className="flex justify-between items-center mb-8">
                    <div>
                        <h1 className="text-3xl font-bold text-white">Documents</h1>
                        <p className="text-slate-400 mt-1">Manage all your generated legal documents here.</p>
                    </div>
                    <button onClick={onStartGeneration} className="bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-blue-500 transition-colors">Generate New Document</button>
                </header>
                <div className="bg-[#0D1117] border border-slate-800 rounded-xl">
                    <table className="w-full text-left">
                        <thead className="border-b border-slate-800"><tr className="text-xs text-slate-400 uppercase"><th className="p-4 font-semibold">Document Name</th><th className="p-4 font-semibold">Status</th><th className="p-4 font-semibold">Created</th><th className="p-4 font-semibold">Version</th><th className="p-4 font-semibold">Actions</th></tr></thead>
                        <tbody>
                            {documents.map(doc => (
                                <tr key={doc.id} className="border-b border-slate-800 last:border-b-0 hover:bg-slate-800/20">
                                    <td className="p-4 text-sm font-medium text-white">{doc.name}</td>
                                    <td className="p-4">{getStatusChip(doc.status)}</td>
                                    <td className="p-4 text-sm">{doc.createdAt}</td>
                                    <td className="p-4 text-sm">{doc.version}</td>
                                    <td className="p-4"><button onClick={() => onSelectDocument(doc.id)} className="text-xs text-blue-400 hover:text-blue-300 font-semibold">View Details</button></td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        );
        
        const DocumentDetailView = ({ document, onBack, onNotification }) => (
            <div>
                <header className="mb-8">
                    <button onClick={onBack} className="flex items-center gap-2 text-sm text-slate-400 hover:text-white mb-4">
                        <BackIcon /> Back to All Documents
                    </button>
                    <div className="flex justify-between items-start">
                        <div>
                           <h1 className="text-3xl font-bold text-white">{document.name}</h1>
                           <div className="mt-2 flex items-center gap-4 text-sm">
                               {getStatusChip(document.status)}
                               <span className="text-slate-500">|</span>
                               <span>Version: {document.version}</span>
                               <span className="text-slate-500">|</span>
                               <span>Created: {document.createdAt}</span>
                           </div>
                        </div>
                        <button onClick={() => onNotification("Generating PDF...")} className="bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-blue-500 transition-colors">Download PDF</button>
                    </div>
                </header>
                <div className="grid grid-cols-3 gap-8">
                    <div className="col-span-2 bg-[#0D1117] border border-slate-800 rounded-xl p-6">
                         <h2 className="text-lg font-semibold text-white mb-4">Audit History</h2>
                         <ul className="space-y-4">
                            {document.auditHistory.map((item, index) => (
                                <li key={index} className="flex items-start gap-4">
                                    <div className={`mt-1.5 w-2.5 h-2.5 rounded-full ${item.result.includes('Pass') || item.result.includes('Approved') ? 'bg-green-500' : (item.result.includes('Warning') ? 'bg-yellow-500' : 'bg-slate-500')}`}></div>
                                    <div>
                                        <p className="font-medium text-white">{item.event}</p>
                                        <p className="text-sm text-slate-400">{item.result}</p>
                                    </div>
                                    <p className="ml-auto text-sm text-slate-500">{item.date}</p>
                                </li>
                            ))}
                         </ul>
                    </div>
                    <div className="col-span-1 space-y-4">
                        <div className="bg-[#0D1117] border border-slate-800 rounded-xl p-6">
                            <h3 className="font-semibold text-white mb-4">Compliance Score</h3>
                            {getComplianceBar(document.score)}
                            <p className="text-xs text-slate-500 mt-2">Last AI Audit: {document.lastAudit}</p>
                        </div>
                        <div className="bg-[#0D1117] border border-slate-800 rounded-xl p-6">
                            <h3 className="font-semibold text-white mb-4">Actions</h3>
                            <div className="flex flex-col space-y-3">
                                <button onClick={() => onNotification("Opening secure share link...")} className="w-full text-left text-sm text-slate-300 hover:text-white font-semibold">Share</button>
                                <button onClick={() => onNotification("Requesting human review...")} className="w-full text-left text-sm text-slate-300 hover:text-white font-semibold">Request Human Review</button>
                                <button onClick={() => onNotification("Opening editor...")} className="w-full text-left text-sm text-slate-300 hover:text-white font-semibold">View in Editor</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        );

        // --- NEW: Audit Reports Components ---
        const AuditReportsListView = ({ onSelectAudit }) => (
            <div>
                 <header className="mb-8">
                    <h1 className="text-3xl font-bold text-white">Audit Reports</h1>
                    <p className="text-slate-400 mt-1">View your weekly automated compliance audits.</p>
                </header>
                <div className="bg-[#0D1117] border border-slate-800 rounded-xl">
                    <table className="w-full text-left">
                        <thead className="border-b border-slate-800"><tr className="text-xs text-slate-400 uppercase"><th className="p-4 font-semibold">Report Date</th><th className="p-4 font-semibold">Status</th><th className="p-4 font-semibold">Summary</th><th className="p-4 font-semibold">Actions</th></tr></thead>
                        <tbody>
                            {auditReportsData.map(report => (
                                <tr key={report.id} className="border-b border-slate-800 last:border-b-0 hover:bg-slate-800/20">
                                    <td className="p-4 text-sm font-medium text-white">{report.date}</td>
                                    <td className="p-4">{getAuditStatusChip(report.status)}</td>
                                    <td className="p-4 text-sm">{report.summary}</td>
                                    <td className="p-4"><button onClick={() => onSelectAudit(report.id)} className="text-xs text-blue-400 hover:text-blue-300 font-semibold">View Report</button></td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        );

        const AuditReportDetailView = ({ report, onBack }) => (
             <div>
                <header className="mb-8">
                    <button onClick={onBack} className="flex items-center gap-2 text-sm text-slate-400 hover:text-white mb-4">
                        <BackIcon /> Back to All Reports
                    </button>
                    <div>
                       <h1 className="text-3xl font-bold text-white">Audit Report: {report.date}</h1>
                       <div className="mt-2 flex items-center gap-4 text-sm">
                           {getAuditStatusChip(report.status)}
                       </div>
                    </div>
                </header>
                <div className="bg-[#0D1117] border border-slate-800 rounded-xl p-6">
                    <h2 className="text-lg font-semibold text-white mb-4">Findings & Recommendations</h2>
                    {report.findings.length > 0 ? (
                        <ul className="space-y-6">
                            {report.findings.map(finding => (
                                <li key={finding.id} className="p-4 bg-slate-800/50 rounded-lg">
                                    <p className="font-semibold text-white">{finding.document}</p>
                                    <p className="text-sm text-slate-300 mt-2"><span className={`font-bold ${finding.severity === 'High' ? 'text-yellow-400' : 'text-slate-400'}`}>{finding.severity} Severity: </span>{finding.description}</p>
                                    <div className="mt-3 border-t border-slate-700 pt-3">
                                        <p className="text-sm font-semibold text-blue-400">Recommendation:</p>
                                        <p className="text-sm text-slate-400">{finding.recommendation}</p>
                                    </div>
                                </li>
                            ))}
                        </ul>
                    ) : (
                        <p className="text-slate-400">No issues or warnings were detected in this audit. Your documents are up-to-date.</p>
                    )}
                </div>
            </div>
        );

        const GenerateDocumentWizard = ({ onClose, onComplete }) => {
            const [step, setStep] = useState(1);
            const [formData, setFormData] = useState({ type: null, companyName: '', dataTypes: [] });

            const handleNext = () => setStep(s => s + 1);
            const handleBack = () => setStep(s => s - 1);

            useEffect(() => {
                if (step === 4) { // Generating step
                    const timer = setTimeout(() => {
                        setStep(5); // Move to success step
                    }, 3000);
                    return () => clearTimeout(timer);
                }
            }, [step]);
            
            const renderStep = () => {
                switch(step) {
                    case 1:
                        const docTypes = ['Privacy Policy', 'Cookie Policy', 'Terms of Service', 'AI Usage Policy'];
                        return (
                            <div>
                                <h2 className="text-xl font-bold text-white text-center">Select Document Type</h2>
                                <p className="text-center text-slate-400 text-sm mt-2 mb-6">Choose a template to start with. The AI will customize it for you.</p>
                                <div className="grid grid-cols-2 gap-4">
                                    {docTypes.map(type => (
                                        <button key={type} onClick={() => { setFormData({...formData, type}); handleNext(); }} className="p-6 bg-slate-800 hover:bg-slate-700 rounded-lg text-white font-semibold text-center transition-colors">
                                            {type}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        );
                    case 2:
                        return (
                            <div>
                                <h2 className="text-xl font-bold text-white text-center">Company Details</h2>
                                <p className="text-center text-slate-400 text-sm mt-2 mb-6">This information will be used to personalize your document.</p>
                                <div className="space-y-4">
                                    <input type="text" value={formData.companyName} onChange={e => setFormData({...formData, companyName: e.target.value})} placeholder="Company Name" className="w-full bg-slate-700 border border-slate-600 rounded-md p-3 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                                </div>
                                <div className="flex gap-4 mt-6">
                                    <button onClick={handleBack} className="w-full bg-slate-700 text-white p-3 rounded-md font-semibold hover:bg-slate-600 transition-colors">Back</button>
                                    <button onClick={handleNext} disabled={!formData.companyName} className="w-full bg-blue-600 text-white p-3 rounded-md font-semibold hover:bg-blue-500 transition-colors disabled:bg-slate-600 disabled:cursor-not-allowed">Next</button>
                                </div>
                            </div>
                        );
                    case 3:
                        const dataOptions = ['User Analytics', 'Contact Forms', 'Payment Information', 'User Accounts', 'Marketing Pixels'];
                        const toggleDataType = (type) => {
                            setFormData(prev => ({
                                ...prev,
                                dataTypes: prev.dataTypes.includes(type) ? prev.dataTypes.filter(t => t !== type) : [...prev.dataTypes, type]
                            }));
                        };
                        return (
                            <div>
                                <h2 className="text-xl font-bold text-white text-center">Data Collection</h2>
                                <p className="text-center text-slate-400 text-sm mt-2 mb-6">Select all types of data your service collects.</p>
                                <div className="space-y-3">
                                    {dataOptions.map(type => (
                                        <button key={type} onClick={() => toggleDataType(type)} className={`w-full flex justify-between items-center p-4 rounded-lg transition-colors ${formData.dataTypes.includes(type) ? 'bg-blue-600 text-white' : 'bg-slate-800 hover:bg-slate-700 text-slate-300'}`}>
                                            <span>{type}</span>
                                            {formData.dataTypes.includes(type) && <CheckIcon />}
                                        </button>
                                    ))}
                                </div>
                                <div className="flex gap-4 mt-6">
                                    <button onClick={handleBack} className="w-full bg-slate-700 text-white p-3 rounded-md font-semibold hover:bg-slate-600 transition-colors">Back</button>
                                    <button onClick={handleNext} className="w-full bg-blue-600 text-white p-3 rounded-md font-semibold hover:bg-blue-500 transition-colors">Generate Document</button>
                                </div>
                            </div>
                        );
                    case 4:
                        return (
                            <div className="text-center generating-animation p-8 rounded-lg">
                                <h2 className="text-xl font-bold text-white">Generating Your Document</h2>
                                <p className="text-slate-400 text-sm mt-2">The Lexium AI engine is analyzing your input and applying relevant legal clauses. This may take a moment...</p>
                                <div className="w-full bg-slate-700 rounded-full h-2.5 mt-6"><div className="bg-blue-600 h-2.5 rounded-full animate-pulse" style={{width: '75%'}}></div></div>
                            </div>
                        );
                    case 5:
                         return (
                            <div className="text-center">
                                <div className="text-6xl mb-4">üéâ</div>
                                <h2 className="text-xl font-bold text-white">Document Generated!</h2>
                                <p className="text-slate-400 text-sm mt-2 mb-6">Your new {formData.type} is ready and has been added to your dashboard as a draft.</p>
                                <button onClick={() => onComplete(formData)} className="w-full bg-blue-600 text-white p-3 rounded-md font-semibold hover:bg-blue-500 transition-colors">Done</button>
                            </div>
                        );
                }
            };

            return (
                <div className="wizard-overlay fixed inset-0 bg-black/70 backdrop-blur-sm z-[60] flex items-center justify-center p-4">
                    <div className="wizard-container w-full max-w-lg bg-[#0D1117] border border-slate-800 rounded-lg shadow-2xl p-8 relative">
                         {step < 4 && <button onClick={onClose} className="absolute top-4 right-4 text-slate-500 hover:text-white">&times;</button>}
                         {renderStep()}
                    </div>
                </div>
            );
        };

        const DashboardContainer = ({ userEmail, onLogout, onNotification, documents, onStartGeneration }) => {
            const [activeView, setActiveView] = useState('dashboard');
            const [selectedDocumentId, setSelectedDocumentId] = useState(null);
            const [selectedAuditId, setSelectedAuditId] = useState(null);

            const handleSetView = (viewName) => {
                setActiveView(viewName);
                setSelectedDocumentId(null);
                setSelectedAuditId(null);
            }

            const renderView = () => {
                switch (activeView) {
                    case 'dashboard':
                        return <MainDashboardView userEmail={userEmail} onStartGeneration={onStartGeneration} documents={documents} onNavigateToAudits={() => handleSetView('audits')} />;
                    case 'documents':
                        if (selectedDocumentId) {
                            const doc = documents.find(d => d.id === selectedDocumentId);
                            return <DocumentDetailView document={doc} onBack={() => setSelectedDocumentId(null)} onNotification={onNotification} />;
                        }
                        return <DocumentsListView documents={documents} onSelectDocument={setSelectedDocumentId} onStartGeneration={onStartGeneration} />;
                    case 'audits':
                        if (selectedAuditId) {
                            const report = auditReportsData.find(r => r.id === selectedAuditId);
                            return <AuditReportDetailView report={report} onBack={() => setSelectedAuditId(null)} />;
                        }
                        return <AuditReportsListView onSelectAudit={setSelectedAuditId} />;
                    case 'settings':
                         return <PlaceholderView title="Company Profile" message="Manage your company details and subscription." />;
                    default:
                        return <MainDashboardView userEmail={userEmail} onStartGeneration={onStartGeneration} documents={documents}/>;
                }
            };
            
            const NavLink = ({ viewName, children, icon }) => (
              <button
                onClick={() => handleSetView(viewName)}
                className={`w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-colors ${activeView === viewName ? 'bg-slate-800 text-white' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}
              >
                {icon}
                <span className="font-semibold text-sm">{children}</span>
              </button>
            );

            return (
                <div className="bg-slate-900 text-slate-300 min-h-screen flex font-sans">
                    <aside className="w-64 bg-[#0D1117] p-6 flex flex-col justify-between border-r border-slate-800">
                        <div>
                            <div className="flex items-center space-x-2.5 mb-10">
                                <div className="w-7 h-7 flex flex-col justify-between">
                                    <div className="h-2 w-full bg-sky-400 rounded-full"></div>
                                    <div className="h-2 w-2/3 bg-blue-600 rounded-full self-end"></div>
                                    <div className="h-2 w-full bg-sky-400 rounded-full"></div>
                                </div>
                                <span className="font-bold text-xl text-white">Lexium AI</span>
                            </div>
                            <nav className="space-y-2">
                                <NavLink viewName="dashboard" icon={<DashboardIcon />}>Dashboard</NavLink>
                                <NavLink viewName="documents" icon={<DocumentIcon />}>Documents</NavLink>
                                <NavLink viewName="audits" icon={<AuditIcon />}>Audit Reports</NavLink>
                            </nav>
                        </div>
                        <nav className="space-y-2">
                           <NavLink viewName="settings" icon={<SettingsIcon />}>Company Profile</NavLink>
                            <button onClick={onLogout} className="w-full flex items-center gap-3 px-3 py-2.5 text-slate-400 hover:bg-slate-800 hover:text-white rounded-lg"><LogoutIcon /><span className="font-semibold text-sm">Logout</span></button>
                        </nav>
                    </aside>

                    <main className="flex-1 p-8">
                        {renderView()}
                    </main>
                </div>
            );
        };

        const App = () => {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [userEmail, setUserEmail] = useState('');
            const [notification, setNotification] = useState('');
            const [documents, setDocuments] = useState(initialDocumentsData);
            const [isWizardOpen, setIsWizardOpen] = useState(false);

            const showNotification = (message) => {
                setNotification(message);
                setTimeout(() => setNotification(''), 3000);
            };

            const handleDocumentGenerated = (formData) => {
                const newDocument = {
                    id: documents.length + 1,
                    name: formData.type || 'New Document',
                    status: 'Draft',
                    score: null,
                    lastAudit: 'N/A',
                    owner: 'You',
                    createdAt: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }),
                    version: '1.0',
                    auditHistory: [{ date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }), event: 'Document Generated', result: 'Initial draft' }]
                };
                setDocuments(prevDocs => [newDocument, ...prevDocs]);
                setIsWizardOpen(false);
                showNotification(`Successfully generated ${newDocument.name}!`);
            };

            useEffect(() => {
                const token = localStorage.getItem('lexium-auth-token');
                const email = localStorage.getItem('lexium-user-email');
                if (token) {
                    setIsAuthenticated(true);
                    setUserEmail(email || 'user@example.com');
                }
            }, []);

            const handleLogin = () => {
                const fakeAuthToken = 'user-logged-in-token-' + Date.now();
                const fakeEmail = 'test-user@lexium.ai';
                localStorage.setItem('lexium-auth-token', fakeAuthToken);
                localStorage.setItem('lexium-user-email', fakeEmail);
                setIsAuthenticated(true);
                setUserEmail(fakeEmail);
            };

            const handleLogout = () => {
                localStorage.removeItem('lexium-auth-token');
                localStorage.removeItem('lexium-user-email');
                setIsAuthenticated(false);
                setUserEmail('');
            };

            if (!isAuthenticated) {
                return <LoginPrompt onLogin={handleLogin} />;
            }
            
            return (
                <>
                    {notification && (
                        <div className="fixed top-5 right-5 z-[70] bg-blue-600 text-white text-sm font-semibold px-4 py-2 rounded-md shadow-lg transition-opacity duration-300">
                            {notification}
                        </div>
                    )}
                    {isWizardOpen && <GenerateDocumentWizard onClose={() => setIsWizardOpen(false)} onComplete={handleDocumentGenerated} />}
                    <DashboardContainer 
                        userEmail={userEmail} 
                        onLogout={handleLogout} 
                        onNotification={showNotification} 
                        documents={documents}
                        onStartGeneration={() => setIsWizardOpen(true)}
                    />
                </>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>

